---
- hosts: CentOSInstall
  remote_user: bynn_chapu
  sudo: yes
  vars:
    target_user: bynn_chapu
    home_dir: "/home/{{ target_user }}"
    dotfile_dir: "{{ home_dir }}/dotfiles"
    neobundle_path: "{{ home_dir }}/.vim/bundle/neobundle.vim"
    ohmyzsh_path: "{{ home_dir }}/.oh-my-zsh"
  tasks:
    - name: Disable SELinux
      command: /sbin/setenforce 0
    - name: Disable SELinux forever
      command: /usr/bin/sed -i "s/\(^SELINUX=\).*/\1disabled/" /etc/selinux/config
    - name: Update packages
      yum: name=* state=latest
    - name: Install Require packages
      yum: name={{ item }} state=latest
      with_items:
        - git
        - vim
        - zsh
    - name: Clone my dotfile repository
      git: repo=https://github.com/bynnchapu/dotfiles.git
           dest={{ dotfile_dir }}
      sudo: no
    - name: Prepare to install NeoBundle
      file: path={{ neobundle_path }} state=directory
      sudo: no
    - name: Install NeoBundle
      git: repo=https://github.com/Shougo/neobundle.vim
           dest={{ neobundle_path }}
      sudo: no
    - name: Install OhMyZsh
      git: repo=https://github.com/robbyrussell/oh-my-zsh.git
           dest={{ ohmyzsh_path }}
      sudo: no
    - name: Copy .gitconfig
      shell: creates="{{ home_dir }}/.gitconfig" cp "{{ dotfile_dir }}/gitconfig.dotfile" "{{ home_dir }}/.gitconfig"
      sudo: no
    - name: Copy .vimrc
      shell: creates="{{ home_dir }}/.vimrc" cp "{{ dotfile_dir }}/vimrc.dotfile" "{{ home_dir }}/.vimrc"
      sudo: no
    - name: Copy .zshrc
      shell: creates="{{ home_dir }}/.zshrc" cp "{{ dotfile_dir }}/zshrc.dotfile" "{{ home_dir }}/.zshrc"
      sudo: no
    - name: Install epel-release
      yum: name=epel-release state=latest
    - name: Install etckeeper
      yum: name=etckeeper state=latest
      notify:
        - Init etckeeper
        - Commit initialize
    - name: Change Login shell
      user: name={{ target_user }} shell=/bin/zsh
  handlers:
    - name: Init etckeeper
      command: /usr/bin/etckeeper init 
    - name: Commit initialize
      command: /usr/bin/etckeeper commit "Initial Commit."
